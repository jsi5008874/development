지금까지 만들었던 UserDao는 기초적인 CRUD 기능만 가지고 있고 비즈니스 로직은 없는 상태이다.
이제 비즈니스 로직을 추가해보자

- 사용자의 레벨은 BASIC, SILVER, GOLD 세 가지 중 하나이다.
- 사용자가 처음 가입하면 BASIC, 이후 활동에 따라 한 단계씩 업그레이드된다.
- 가입 후 50회 이상 로그인하면 SILVER
- SILVER 레벨이면서 30번 이상 추천을 받으면 GOLD
- 사용자 레벨의 변경 작업은 일정한 주기를 가지고 일괄적으로 진행, 변경 작업 전에는 조건을 충족해도 레벨은 유지

## 필드 추가
### Level Enum
level을 varchar 타입으로 해서 만들어도 되지만 숫자를 코드화해서 넣는 방법을 사용한다.
DB용량도 덜 차지하고 가벼워서 더 장점이 있다.

**타입 안정성을 위해 Enum 타입으로 작성**

그냥 private static final로 선언해서 사용해도 상관은 없지만
user1.setLever(other.getsum());
user1.setLever(1000);
이런식으로 의도치 않게 전혀 다른 숫자가 나올 수 있고 이런 경우에는 컴파일 에러에서도 못잡기 때문에 enum으로 작성

```java
public enum Level {
	BASIC(1), SILVER(2), GOLD(3); // 3개의 이늄 오브젝트 정의

	private final int value;

	Level(int value) {
		this.value = value; // DB에 저장할 값을 넣어줄 생성자
	}

	public int intValue(){
		return value; // 값을 가져오는 메소드
	}

	public static Level valueOf(int value){ // 값으로부터 Level타입 오브젝트를 가져오도록 만드는 메소드
		switch(value){
			case 1: return BASIC;
			case 2: return SILVER;
			case 3: return GOLD;
			default: throw new AssertionError("UNKOWN value : " + value);
		}
	}
}
```

### User 필드 추가
```java
public class User{
.....
Level level;
int login;
int recommend;

public Level getLever(){
	return level;
}

public void setLevel(Level level){
	this.level = level;
}
......
}
```

이후 DB에 level, login, recommend 컬럼 추가
### UserDaoTest 수정
```java
public class UserDaoTest{

	@Before
	public void setup(){
		this.user1 = new User("gyumee", "박성철", "springno1", Level.BASIC, 1, 0);
	}
}
```

### UserDaoJdbc 수정
```java
public class UserDaoJdbc implements UserDao{
...
	private RowMapper<User> userMapper = new RowMapper<User>(){
		public User mapRow(ResultSet rs, int rowNum) throws SQLExeption{
			User user = new User();
			user.setId(rs.getString("id"));
			user.setName(rs.getString("name"));
			user.setPassword(rs.getString("password"));
			user.setLevel(Level.valueOf(rs.getInt("level")));
			user.setlogin(rs.getInt("login"));
			user.setRecommend(rs.getInt("recommend"));
			return user;
		}
	}
};
public void add(User user){
	this.jdbcTemplate.update{
		"insert into users(id, name, password, level, login, recommend)" + 
		"values(?,?,?,?,?,?)", user.getId(), user.getName(), user.getPassword,
		user.getLevel().intValue(), user.getLogin(), user.getRecommend();
	}
}
```
Level 이늄은 오브젝트이므로 DB에 저장될 수 없기 때문에 저장 가능한 정수형으로 변환해줘야한다.
각 이늄의 DB 저장용 값을 얻기 위해서는 Level에 미리 만들어둔 intValue() 메소드를 사용한다.

