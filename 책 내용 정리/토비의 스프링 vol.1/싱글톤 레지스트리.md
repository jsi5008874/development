  

### 오브젝트의 동일성(Identity)과 동등성(Equality)

자바에서 오브젝트의 동일성은 완전히 같은 객체 == 연산자로 비교한다.

즉 아예 메모리상의 주소가 같은 하나의 객체를 뜻함

  

동등성은 보유한 값이 같은 것을 뜻하며 equals() 메소드로 비교한다.

즉 서로 다른 객체지만 내용이 같은것을 뜻함

  

ex)

```Java
DaoFactory factory = new DaoFactory();
UserDao dao1 = factory..userDao();
UserDao dao2 = factory..userDao();

system.out.println(dao1);
system.out.println(dao2);

//결과값
springbook.dao.UserDao@118f375
springbook.dao.UserDao@117a8bd
```

이렇게 했을 때 new 연산자를 통해 새로운 객체를 두 번 생성했기 때문에 서로 다른 객체이다.

서로 다른 메모리 주소에 적재된 두 개의 객체가 생성된 것

동등성은 가질 수 있으나 동일성은 성립되지 않는 형태이다.

  

하지만 애플리케이션 컨텍스트를 활용하면 동일한 객체를 활용한다.

ex)

```Java
ApplicationContext context = new AnnotationConfigApplicationContext(DaoFactory.class);

UserDao dao3 = context.getBean("userDao", UserDao.class);
UserDao dao4 = context.getBean("userDao", UserDao.class);

system.out.println(dao3);
system.out.println(dao4);

//결과값
springbook.dao.UserDao@ee22f7
springbook.dao.UserDao@ee22f7
```

결과 값을 보면 같은 객체임을 확인할 수 있다.

getBean()을 두 번 호출해서 가져온 오브젝트는 동일하다.

**즉 스프링은 여러 번 빈을 호출하더라도 동일한 오브젝트를 돌려준다.**

  

**싱글톤 레지스트리 : 싱글톤을 저장하고 관리하는 것**

  

애플리케이션 컨텍스트는 싱글톤 레지스트리이다.

**스프링은 기본적으로 별다른 설정을 하지 않으면 빈 오브젝트를 모두 싱글톤으로 생성**

디자인 패턴 중 싱글톤 패턴과 비슷하지만 구현 방법은 다르다.

  

**자바 싱글톤 구현방법**

1. 클래스 밖에서 오브젝트를 생성하지 못하도록 private로 만든다.
2. 생성된 싱글톤 오브젝트를 저장할 수 있는 같은 타입의 스태틱 필드를 정의한다.
3. 스태택 팩토리 메소드인 getInstance()를 만들고 메소드가 최초로 호출되는 시점에만 오브젝트가 생성되도록 한다.(생성된 오브젝트는 스태틱 필드에 저장)
4. 한번 오브젝트가 만들어지고 난 후에는 getInstance() 메소드를 통해 스태틱 필드에 저장해둔 오브젝트를 넘겨준다.

  

### 스프링에서 싱글톤을 사용하는 이유

스프링은 자바 엔터프라이즈 기술을 사용하는 서버환경에서 주로 사용한다.

대규모의 서버 환경은 대규모의 요청을 처리하도록 설계되어야한다.

요청을 한 개를 처리하기 위해서는 일반적으로 데이터 액세스 로직, 서비스 로직, 비즈니스 로직, 프레젠테이션 로직 등 다양한 오브젝트들이 참여한다.

요청이 올 때마다 5개의 오브젝트가 새로 만들어진다면 서버는 엄청난 양의 오브젝트를 생성한다.

아무리 가비지 컬렉션 성능이 좋아졌다 해도 1초에 수십, 수백개씩 요청이 들어오면 서버에 엄청난 부하가 생기게된다.

그래서 스프링에서는 싱글톤으로 오브젝트를 공유해서 사용한다.

  

### 싱글톤 패턴의 한계

1. private 생성자를 갖고 있기 때문에 상속할 수 없다.

오직 싱글톤 클래스 자신만이 오브젝트를 만들도록 제한하기 때문에 상속이 불가하다.

그렇다면 객체지향의 장점임 상속, 다형성을 적용할 수 없다.

1. 싱글톤은 테스트하기가 힘들다

싱글톤은 초기화 과정에서 생성자 등을 통해 사용할 오브젝트를 다이나믹하게 주입하기 힘들기

때문에 필요한 오브젝트를 직접 만들어 사용해야하고 이는 테스트용으로 대체하기가 힘들다.

1. 서버환경에서 싱글톤이 하나만 만들어지는 것을 보장할 수 없다.

여러 JVM에 분산되서 설치되는 경우 각각 독립적으로 오브젝트가 생성되기 때문에 싱글톤

보장이 어렵다.

1. 싱글톤의 사용은 전역 상태를 만들 수 있기 때문에 바람직하지 못하다

싱글톤의 스태틱 메서드를 이용해 언제든 쉽게 접근할 수 있기 때문에 애플리케이션 어디서든지

사용될 수 있고 이는 전역 상태로 사용되기 쉽다.

전역상태를 갖는것은 객체지향에서 권장되지 않는 프로그래밍 모델이다.

  

### 스프링의 싱글톤 레지스트리

자바에서 싱글톤은 private 생성자와 스태틱 메소드를 활용해서 여러 한계점이 있었다.

**하지만 스프링에서는 private 생성자, 스태틱 메소드 없는 평범한 자바 클래스라도 IOC 방식의 컨테이너를 활용해서 손쉽게 싱글톤 방식으로 관리할 수 있다.**

  

**스프링은 IOC 컨테이너이면서 싱글톤을 만들고 관리해주는 싱글톤 레지스트리이다.**

  

  

### 싱글톤과 오브젝트의 상태

싱글톤은 멀티스레드 환경이라면 여러 스레드가 동시에 접근해서 사용할 수 있다.

따라서 상태 관리에 주의해야한다.

보통 상태정보를 내부에가지고 있지 않은 무상태 방식으로 만들어진다.

인스턴스 필드의 값을 변경하고 유지하는 상태유지 방식으로 만들어진다면 여러 스레드에 의해

정보가 변경되어 데이터의 혼동이 생길 위험이 크다.

  

따라서 인스턴스 필드로는 읽기 전용 정보들에 한해서 선언하는것이 좋다.

읽기 전용의 속성을 가진 정보라면 여러 스레드가 접근하여도 데이터가 변경될 일이 없기 때문이다.

  

### 스프링 빈의 스코프

빈이 생성, 존재, 적용되는 범위를 빈 스코프라고한다.

스프링 빈의 기본 스코프는 싱글톤이며 컨테이너 내에 한 개의 오브젝트만 만들어져 강제로 제거하지 않는 한 계속 존재한다.

  

프로토타입 스코프 : 컨테이너에 빈을 요청할 때마다 새로운 오브젝트 생성

요청 스코프 : HTTP 요청이 생길 때마다 생성

세션 스코프 : 웹의 세션과 유사한 스코프