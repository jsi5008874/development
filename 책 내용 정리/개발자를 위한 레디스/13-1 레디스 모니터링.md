
## 레디스 모니터링 구축하기

### 프로메테우스와 그라파나를 이용한 레디스 모니터링
#### 레디스 모니터링 구조
![[KakaoTalk_Photo_2025-10-22-13-10-32.jpeg|725]]
익스포터(Exporter)란 시스템의 상태를 실시간으로 스크랩해서 메트릭(측정 가능한 수치, 지표)을 수집하는 프로그램
레디스 익스포터는 레디스 인스턴스의 실시간 정보를 수집하며 노드 익스포터는 레디스가 실행되는 서버의 하드웨어와 OS 관련 메트릭을 수집

**프로메테우스**
프로메테우스는 메트릭 기반의 오픈 소스 모니터링 시스템
시계열 형태로 저장되며 간단하고 빠르게 데이터를 수집
지정한 타깃으로 직접 접근해 데이터를 pull 방식으로 수집하며 타깃은 모니터링 하고자 하는 시스템의 익스포터를 지정

**그라파나**
오픈 소스 메트릭 데이터 시각화 도구
데이터를 시각화해서 시스템 분석과 모니터링을 용이하게 해주는 플랫폼
프로메테우스를 데이터 소스로 추가하면 레디스 서버의 메트릭을 수집한 프로메테우스의 정보를 시각화 가능

프로메테우스 : 데이터 수집 >> 그라파나 : 프로메테우스가 수집한 데이터를 시각화

![[KakaoTalk_Photo_2025-10-22-13-23-38.jpeg|750]]

#### 노드 익스포터 설치

노드 익스포터 설치 명령어
```
$ wget https://github.com/prometheus/node_exporter/releases/download/v1.5.0/node_exporter-1.5.0.linux-amd64.tar.gz
>> node_exporter 설치 파일 다운로드 명령어

$ tar -zxvf node_expoter-1.5.0.linux-amd64.tar.gz
>> 설치 파일 압축해제

$ rm node_exporter-1.5.0.linux-amd64.tar.gz
>> 압축 파일 삭제

$ ln -s node_exporter-1.5.0.linux-amd64/ node_exporter
>> 심볼릭 링크 생성
```

노드 익스포터 실행 명령어
```
$ cd node_exporter
$ nohup ./node_exporter > node_exporter.log &
>> nohup : 터미널 세션이 끊겨도 프로세스가 계속 실행되도록 하는 명령어
>> ./node_exporter : ./는 현재 디렉토리를 뜻하며 현재 디렉토리에 있는 node_exporter 실행 파일을 실행하라는 뜻
>> > node_exporter.log & : 표준 출력(stdout)을 node_exporter.log 파일로 리다이렉션하고 &는 명령어를 백그라운드에서 실행
```
노드 익스포터를 아무런 설정 없이 실행시키면 기본 옵션으로 실행된다.
9100번 포트에서 실행
#### 레디스 익스포터 설치

레디스 익스포터 설치 명령어
```
$ wget https://github.com/oliver006/redis_exporter/releases/download/v1.45.0/redis_exporter-v1.45.0.linux-amd64.tar.gz
$ tar -zxvf redis_exporter-v1.45.0.linux-amd64.tar.gz
$ rm redis_exporter-v1.45.0.linux-amd64.tar.gz
$ ln -s redis_exporter-v1.45.0.linux-amd64.tar.gz/ redis_exporter
```

레디스 익스포터 실행
```
$ cd redis_exporter
$ nohup ./redis_exporter > redis_exporter.log &
```
레디스 익스포터를 설정 변경 없이 실행하면 기본 옵션으로 실행된다.
9121 포트에서 실행

만약 레디스에 패스워드 지정, 포트 변경등이 되어있었다면 실행할 때 플래그를 추가해야 한다.
```
$ cd redis_exporter
$ nohup ./redis_exporter --redis.addr=redis://127.0.0.1:7379 -redis.password=password > redis_exporter.log &
>> redis.addr, redis.password 등의 옵션을 추가하여 변경할 값들을 넣어주면 된다.
```

#### 얼럿 매니저 설치
모니터링 서버에 얼럿 매니저를 설치한다.
얼럿 매니저 설치
```
$ wget https://github.com/prometheus/alertmanager/releases/download/v0.25.0/alertmanager-0.25.0.linux-amd64.tar.gz
$ tar -zxvf alertmanager.0.25.0.linux-amd64.tar.gz
$ rm alertmanager.0.25.0.linux-amd64.tar.gz
$ ln -s alertmanager.0.25.0.linux-amd64/ alertmanager
```
예제에서는 특정 임계치에 도달했을 때 디스코드를 이용해 알람을 받도록 설정
얼럿 매니저의 설정 파일을 수정해야한다.

```
cd alertmanager
vi alertmanager.yml
==================================
alertmanager.yml 파일
....
webhook_url : 웹훅 url 입력
>> 디스코드, 슬랙 등 메시지 앱의 웹훅을 입력한다.
```

알람을 받을 정보에 대한 규칙을 생성
```
vi alert.rules
>> alert.rules 파일에서 규칙을 정의
```

얼럿 매니저 실행
```
$ nohup ./alertmanager --config.file=alertmanager.yml > alertmanager.log &
```

ip:9093에 접속하면 얼럿 매니저 화면을 확인할 수 있다.

#### 프로메테우스 설치
모니터링 서버에 프로메테우스를 설치한다.
```
$ wget https://github.com/prometheus/prometheus/releases/download/v2.41.0/prometheus-2.41.0.linux-amd64.tar.gz
$ tar -zxvf prometheus-2.41.0.linux-amd64.tar.gz
$ rm prometheus-2.41.0.linux-amd64.tar.gz
$ ln -s prometheus-2.41.0.linux-amd64/ prometheus
```

프로메테우스가 모니터링할 타깃은 prometheus.yml에서 지정할 수 있다.

프로메테우스 실행
```
$ nohup ./prometheus --config.file=prometheus.yml --storage.tsdb.path=./data --storage.tsdb.retention.time=30d
--web.enable-lifecycle > prometheus.log &
```
ip:9090에 접속하면 프로메테우스 화면을 볼 수 있다.
![[KakaoTalk_Photo_2025-10-23-14-58-22.jpeg|700]]
alert 탭에 가면 alert.yml에서 설정한 알람 설정들을 확인할 수 있다.
임계치에 도달하면 지정한 웹훅으로 알람을 전송한다.

#### 그라파나 설치
모니터링 서버에 그라파나 설치
```
$ wget https://dl.gragana.com/oss/release/grafana-9.3.2.linux-amd64.tar.gz
$ tar -zxvf grafana-9.3.2.linux-amd64.tar.gz
$ rm grafana-9.3.2.linux-amd64.tar.gz
$ ln -s grafana-9.3.2.linux-amd64/ grafana
```

그라파나 실행
```
$ nohup bin/grafana-server start > grafana.log &
```
ip주소:3000에 접속하면 그라파나 화면을 확인할 수 있다.

앞서 생성해둔 프로메테우스를 그라파나 데이터 소스로 추가함으로써 그라파나에서 데이터를 확인할 수 있다.

add data source > 프로메테우스 url을 넣으면 추가된다.

#### 대시보드 생성

![[KakaoTalk_Photo_2025-10-23-15-50-34 001.jpeg|625]]
공식 홈페이지에서 제공하는 대시보드의 ID를 복사해서 붙여 넣은 뒤 로드 하면 대시보드가 추가된다.

![[KakaoTalk_Photo_2025-10-23-15-50-34 002.jpeg|800]]
추가된 대시보드 화면

데이터는 프로메테우스에서 일정 기간동안 보관되기 때문에 원하는 시점의 그래프를 볼 수 있다.

### 레디스 플러그인을 이용한 그라파나 대시보드
프로메테우스라는 중간 저장소 없이 그라파나에서 레디스의 데이터를 확인하고 실시간으로 변경할 수 있다.

그라파나에서 레디스 플러그인을 설치하면 RedisGrafana에서 제공하는 대시보드를 이용해 실시간으로 레디스의 상태를 확인할 수 있다.
앞선 방법과 다르게 레디스 익스포터를 설치할 필요가 없어서 온프레미스 또는 클라우드 상품의 레디스에서도 실시간으로 대시보드를 확인할 수 있다.

#### 레디스 플러그인 설치
1. 플러그인 설치 : grafana > plugin > redis, redis application 플러그인 설치
2. 데이터 소스 추가 : grafana > data source > address에 레디스 주소 입력

직접 레디스로부터 데이터를 수집하여 대시보드에서 확인이 가능해진다.
또한 redis-cli 패널을 제공해서 그라파나에서 바로 레디스에 커맨드를 수행할 수 있다.

