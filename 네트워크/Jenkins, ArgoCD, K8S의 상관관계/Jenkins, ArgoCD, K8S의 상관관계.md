
**회사의 배포 파이프라인 흐름**
- Jenkins가 소스 코드를 빌드하고 테스트하여 컨테이너 이미지 생성 (CI)
- 생성된 이미지와 함께 Kubernetes 매니페스트 파일 업데이트
- ArgoCD가 이 변경사항을 감지하고 Kubernetes 클러스터에 배포 (CD)

회사의 배포과정을 보면서 문득 궁금해졌다.
jenkins, argoCD, k8s는 각각 어떤 역할을 하는 녀석들일까...

배포의 흐름은 알고 있었지만 정확히 각 요소가 어떤 역할을 하는지 모르고 있었다.
그래서 집중적으로 공부해보려고 이 글을 작성한다.

먼저 Jenkins, ArgoCD, k8s가 각각  어떤 역할을 하는지 정확히 알아보고 시작해야 할 것 같아 정리를 했다.
## [[Jenkins]]

## [[ArgoCD]]

## [[K8S(쿠버네티스)]]


## CI/CD 플로우
![[Pasted image 20250414214756.png]]

1. **Git 변경 감지**
    - Git 저장소(GitHub, GitLab, Bitbucket 등)에 코드 변경사항(push, PR merge 등)이 발생
    - Jenkins는 웹훅(webhook)을 통해 실시간으로 변경을 감지하거나 폴링 방식으로 주기적으로 확인
    - 변경이 감지되면 Jenkins 파이프라인 또는 Job이 자동으로 트리거됨
    - 특정 브랜치(master, main, develop 등)나 태그에 대해서만 빌드를 수행하도록 필터 적용 가능

2. **빌드, 테스트, 도커 이미지 생성**
    - Jenkins는 소스 코드를 체크아웃하고 빌드 도구(Maven, Gradle, npm 등)를 사용하여 애플리케이션 빌드
    - 단위 테스트, 통합 테스트, 코드 품질 검사 등 자동화된 테스트 수행
    - 테스트가 성공하면 Dockerfile을 기반으로 도커 이미지 빌드
    - 이미지 태그는 일반적으로 Git 커밋 해시, 빌드 번호, 또는 시맨틱 버전(v1.2.3)을 사용
    - 도커 이미지 태그를 매니페스트 파일(deployment.yaml 등)에 자동으로 업데이트

3. **이미지 업로드**
    - 생성된 도커 이미지를 Docker Hub, AWS ECR, Google GCR, Harbor 등 컨테이너 레지스트리에 푸시
    - Jenkins는 레지스트리 인증 정보를 사용하여 안전하게 이미지 업로드

4. **매니페스트 업데이트**
    - 쿠버네티스 매니페스트 파일(YAML)의 이미지 태그를 새 버전으로 업데이트
    - 이 작업은 Jenkins 파이프라인 내에서 자동화(sed, yq 등 도구 사용)
    - 변경된 매니페스트 파일을 Git 저장소에 자동으로 커밋 및 푸시
    - GitOps 워크플로우에 따라 인프라 변경사항을 코드로 관리(Infrastructure as Code)

5. **매니페스트 변경 감지**
    - ArgoCD가 Git 저장소를 지속적으로 모니터링하며 매니페스트 변경사항 감지
    - ArgoCD는 매니페스트 저장소와 클러스터 상태를 동기화하는 GitOps 컨트롤러
    - 설정된 동기화 정책에 따라 자동 또는 수동으로 변경사항 적용

6. **매니페스트 적용**
    - ArgoCD는 감지된 변경사항을 쿠버네티스 API 서버에 전달
    - 차이점 분석(diff)을 통해 현재 상태와 목표 상태 간의 변경사항 식별
    - 리소스 생성, 업데이트, 삭제 등 필요한 변경 작업 수행
    - 변경 적용 순서와 의존성을 고려하여 점진적으로 배포(각 리소스 타입별 우선순위)

7. **업데이트된 이미지 풀(Pull)**
    - 쿠버네티스 노드의 kubelet이 새 이미지 참조를 감지
    - 컨테이너 런타임(Docker, containerd)이 레지스트리에서 이미지 다운로드
    - 필요한 인증 정보는 쿠버네티스 Secret으로 관리(imagePullSecrets)

8. **컨테이너 실행**
    - 기존 파드는 배포 전략(RollingUpdate, Recreate 등)에 따라 순차적으로 교체
    - 새 컨테이너는 라이브니스 프로브(Liveness Probe)와 레디니스 프로브(Readiness Probe)를 통과해야 트래픽 수신
    - 리소스 제한 및 요청에 따라 CPU, 메모리 할당
    - ConfigMap, Secret 등을 통해 환경 변수 및 설정 주입
    - 서비스 메시(Istio 등)가 있다면 트래픽 점진적 전환 및 카나리 배포 수행


## 최종 정리
Jenkins, ArgoCd, K8S는 순차적 흐름에 따라 작동한다.

Jenkins가 변경된 코드를 통해 빌드, 테스트, 도커 이미지  생성, 매니페스트 수정을 하면
ArgoCD가 변경점을 식별하여 K8S에게 해당 변경점을 전달
K8S는 차이점을 식별하여 이미지 다운로드, 파드 배포 등 관리적 측면에서 컨테이너 오케스트레이션 플랫폼의 역할을 수행

**JenKins가 CI > ArgoCD가 CD > K8S가 변경사항을 취합하여 실제로 실행**

