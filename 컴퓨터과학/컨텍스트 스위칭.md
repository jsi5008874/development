  

정의 : CPU/코어 에서 실행 중이던 프로세스 / 스레드가 다른 프로레스 / 스레드로 교체 되는 것

  

컨텍스트란 ? 프로세스 / 스레드의 상태(CPU, 메모리 등등)

  

컨텍스트 스위칭이 필요한 이유

여러 프로세스 / 스레드를 동시에 실행시키기 위해서

  

컨텍스트 스위칭은 언제 발생하는가?

주어진 time slice(quantum)를 다 사용했거나

IO작업을 해야하거나

다른 리소스를 기다려하는 등 여러가지 이유가 있음

  

컨텍스트 스위칭은 누구에 의해 실행되는가?

OS 커널(kernel)에 의해 실행 : 각종 리소스를 관리 / 감독하는 역할

  

컨텍스트 스위칭은 구체적으로 어떤 과정으로 일어나는가?

>> 다른 프로세스끼리 스위칭인지 같은 프로세스의 스로드들끼리 스위칭인지에 따라 다르다

1. 다른 프로세스끼리 스위칭 : 프로세스 컨텍스트 스위칭
2. 같은 프로세스의 스레드들끼리 스위칭 : 스레드 컨텍스트 스위칭

  

위 두가지의 공통점

1. 커널 모드에서 실행

CPU에서 프로세스 / 스레드가 실행되다가 커널이 직접 통제하고 운영하게 되는것

1. CPU의 레지스터 상태를 교체

P1이 CPU에서 실행되다가 스위칭이 발생하면 P1의 레지스터 상태를 저장하고 P2가 샐행될 때 P2의 레지스터 상태를 가져와 실행, P2에서 P1으로 스위칭 할때도 현재 P2의 레지스터 상태를 저장하고 아까 저장해둔 P1의 레지스터 상태를 그대로 가져와 실행

  

둘의 차이점

프로세스 컨텍스트 스위칭은 가상 메모리 주소 관련 처리를 추가로 수행

1. MMU(Memory Management Unit) : CPU에서 가상 주소를 물리 주소로 변환하는 작업을 주도함

mmu가 다음으로 실행될 프로세스 메모리를 보도록 설정

1. TLB(**Translation Lookaside Buffer**) : mmu 내부에 있는 캐시 메모리

실행중인 프로세스의 TLB 내부의 캐시값을 지워야함(지우지 않으면 원하지 않는 프로세스를 가르킬 수 있음)

  

ex) 같은 프로세스의 스레드들끼리 컨텍스트 스위칭을 하면

T1 실행중 > 컨텍스트 스위칭 필요 > OS 커널모드 진입 > T1의 CPU상태 저장, T2의 CPU상태 로딩 > OS커널모드 종료 > T2 실행 ……..

이런식으로 CPU의 상태 저장, 로딩 등의 행동이 필요하지만

  

다른 프로세스끼리 컨텍스트 스위칭을 하면

P1 실행중 > 컨텍스트 스위칭 필요 > OS 커널모드 진입 > P1의 CPU상태 저장, P2의 CPU상태 로딩 > MMU: P2 메모리 바라보도록 설정, TLB 비움 > OS커널모드 종료 > P2 실행 ……..

이런식으로 mmu관련 추가적인 행동이 필요하다.

  

따라서 스레드 컨텍스트 스위칭이 더 빠른이유는 메모리 주소 관련 처리는 하지 않기 때문이다.

  

컨텍스트 스위칭이 미치는 간접적인 영향

캐시(cache) 오염(pollution) : 컨텍스트 스위칭을 하면 CPU 내부의 cache 영역에 현재 필요로 하는 프로세스 / 스레드의 정보가 없고 이전에 실행되던 프로세스 / 스레드의 정보가 담겨있을 가능성이 있다. 따라서 cache에 들렀다 메모리로 가는 성능에 더 악영향을 주는 캐시오염이 발생할 수 있다.