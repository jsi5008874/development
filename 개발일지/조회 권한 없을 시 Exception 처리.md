![[Pasted image 20241121182614.png]]

대출자의 대출현황 상세페이지 접속 시 권한이 없을 때 exception이 발생하는데
위 의 코드에 나오듯이 mbci가 null이거나 일치하지 않으면 exception이 발생
그런데 해당 오류가 자주 발생해서 분석을 했음

대출 상세페이지를 들어가려면 DB상 해당 대출상품의 mbci와 접속하려는 자의 mbci가
일치해야 상세페이지에 접근이 가능함

상세페이지에 접근할 수 있는 방법은 세 가지로
1.  회사에서 발송하는 메세지를 통해 접속
2. 상세페이지 URL을 입력해서 접속
    http://localhost:8080/sp/loan/application/detail/3039 이렇게 상품번호가 들어간 URL직접 입력해서 접속하는 방법임
3. 현재 마이페이지 기능이 없어서 대출 상세페이지를 보려면 대출하기 > 대출신청 > 기존 대출리스트 > 상세페이지


2번은 현실적으로 가능성이 거의 없고 1번 또는 3번으로 접속하는 경우가 대부분일텐데
1번 또는 3번에서도 exception이 발생할 가능성이 적음

1번의 경우 mbci를 획득하는 경로
![[Pasted image 20241122092946.png]]
애초에 메세지에서 보내는 URL에 mbci값을 쿼리스트링으로 세팅해서 보내주기 때문에
문자 메세지가 타인에게 발송되지 않는 한 발생할 확률은 없음

3번의 경우에도 회사 사이트에 로그인해서 대출하기로 들어가면 쿠키에 mbci값이 세팅되어서 대출 상세페이지로 넘어가기 때문에 exception 발생 확률은 거의 없음

추측은 기존에 접속했던 방문기록을 통해 mbci값이 없는 상태에서 바로 상세페이지로 접근했을 가능성이 있음 >> 바로 접근하면 쿠키의 mbci가 null이기 때문에 exception 발생

따라서 mbci가 null이거나 불일치하면 exception을 던지는 것이 아닌
컨트롤러에서 분기처리로 본인인증 화면으로 이동 or 403 에러 화면 출력으로 대체

컨트롤러
![[Pasted image 20241122093608.png]]

분기처리의 케이스를 switch-case 구문으로 분류하여 각 상황에 맞는 view로 매핑
case 0 > 정상일 때 대출 상세페이지로 전환
case 1 > mbci가 null일 때 본인인증 페이지로 전환
case 2 > 문자로 받은 ci값이 불일치 할 때 403 페이지로 전환
case 3 > 쿠키의 mbci값이 불일치 할 때 403 페이지로 전환
case 4 > 쿠키의 mbci, 문자로 받은 ci값 모두 불일치 할 때 403 페이지로 전환



Service
![[Pasted image 20241122093736.png]]
각 case에 따른 return 값을 설정하여 controller로 리턴