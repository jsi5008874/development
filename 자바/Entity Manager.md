  

JPA (Java Persistence API)에서 엔티티 객체와 데이터베이스 사이의 상호작용을 관리하는 핵심 역할

  

JPA의 영속성 컨텍스트(Persistence Context)를 관리하고, 엔티티의 생명 주기를 제어하며, 데이터베이스 작업을 수행하는 데 필요한 여러 기능을 제공

  

### **1. 엔티티의 영속성 관리**

- `**EntityManager**`는 **엔티티 객체를 영속성 컨텍스트에 관리**합니다. 이를 통해 엔티티 객체는 데이터베이스와 동기화되며, 변경 사항이 추적됩니다.
- 예를 들어, 객체를 `**persist()**` 메서드로 저장하거나, `**merge()**` 메서드로 갱신할 때, `**EntityManager**`는 이 객체의 상태를 영속성 컨텍스트에 반영합니다.

### **2. 영속성 상태 관리**

`**EntityManager**`는 엔티티 객체의 상태를 관리합니다. 엔티티 객체는 다음과 같은 상태로 존재할 수 있습니다:

- **새로운 상태 (Transient State)**: 데이터베이스에 저장되지 않은 새로운 객체. `**EntityManager**`에 의해 관리되지 않습니다.
- **영속 상태 (Persistent State)**: `**EntityManager**`가 관리하는 객체로, 데이터베이스와 동기화된 상태입니다. 예를 들어, `**persist()**`를 호출하면 객체는 영속 상태로 전환됩니다.
- **준영속 상태 (Detached State)**: 영속성 컨텍스트에서 분리된 상태로, `**EntityManager**`에 의해 더 이상 관리되지 않습니다. 예를 들어, `**EntityManager.close()**` 또는 트랜잭션 종료 후 객체는 준영속 상태가 됩니다. `**EntityManager.detach()**`**는 특정 엔티티 객체를 준영속 상태로 만들 때 사용**
- **삭제 상태 (Removed State)**: `**remove()**` 메서드를 호출하면 엔티티는 삭제 상태로 표시되고, 트랜잭션 커밋 시 데이터베이스에서 제거됩니다. delete 쿼리를 날리는 것

### **3. 데이터베이스와의 상호작용**

`**EntityManager**`는 데이터베이스와의 **모든 CRUD 작업(Create, Read, Update, Delete)**을 처리합니다.

- **저장 (Create)**: `**persist()**` 메서드를 사용하여 새로운 엔티티를 데이터베이스에 저장합니다.
- **조회 (Read)**: `**find()**`, `**getReference()**`, `**createQuery()**` 등을 사용하여 데이터베이스에서 엔티티를 조회합니다.
- **업데이트 (Update)**: `**merge()**` 메서드를 사용하여 기존 엔티티를 갱신합니다.
- **삭제 (Delete)**: `**remove()**` 메서드를 사용하여 엔티티를 데이터베이스에서 삭제합니다.

### **4. 트랜잭션 관리**

`**EntityManager**`는 트랜잭션 범위 내에서 엔티티의 상태를 추적합니다. JPA에서는 트랜잭션을 통해 엔티티 객체의 변경 사항을 데이터베이스에 반영합니다.

- **트랜잭션 내에서 엔티티 변경 사항을 추적**하고, 트랜잭션이 커밋될 때 변경된 내용을 자동으로 데이터베이스에 반영합니다.
- 트랜잭션이 롤백되면, **변경된 내용은 데이터베이스에 반영되지 않습니다**.

### **5. 쿼리 실행**

`**EntityManager**`는 **JPQL(Java Persistence Query Language) 또는 SQL 쿼리**를 실행하는 데 사용됩니다.

- **JPQL**: 객체 지향 쿼리 언어로, 엔티티 객체와 관련된 쿼리를 작성할 수 있습니다.
- **Criteria API**: 프로그램적으로 타입 안전한 쿼리를 작성할 수 있는 API를 제공합니다.
- **Native SQL**: 데이터베이스의 네이티브 SQL을 직접 실행할 수 있는 방법을 제공합니다.

### **6. 플러시(Flush)와 커밋(Commit)**

- **플러시 (Flush)**: `**flush()**` 메서드는 영속성 컨텍스트의 변경 내용을 데이터베이스에 즉시 반영하도록 강제합니다. 이는 트랜잭션이 커밋되기 전에 데이터베이스와 동기화하는 방법입니다.
- **커밋 (Commit)**: 실제 트랜잭션을 완료하고 데이터베이스에 반영하는 과정입니다. `**flush()**`와는 달리, 커밋은 트랜잭션의 끝에서 일어납니다.

### **7. 엔티티 객체 조회**

`**EntityManager**`는 엔티티 객체를 데이터베이스에서 조회하는 여러 방법을 제공합니다.

- `**find()**`: 기본적인 조회 메서드로, 기본 키를 통해 엔티티를 찾습니다.
- `**getReference()**`: 프록시 객체를 반환하며, 실제 데이터베이스 조회는 필요한 시점에 이루어집니다.
- `**createQuery()**`: JPQL을 사용하여 복잡한 쿼리를 작성하고 실행할 수 있습니다.

  

### Entity Manger 역할 요약

- `**EntityManager**`는 **JPA의 핵심**으로, 엔티티 객체의 생명 주기를 관리하고, 데이터베이스와의 상호작용을 담당합니다.
- **영속성 컨텍스트 관리**, **트랜잭션 관리**, **쿼리 실행** 등을 처리하며, **엔티티 객체를 영속성 상태로 만들어 데이터베이스와 동기화**합니다.
- 트랜잭션을 통해 엔티티의 변경 내용을 관리하고, 데이터베이스와의 일관성을 유지하는 중요한 역할을 합니다.