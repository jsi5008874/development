  

- 3-tier-architecture에서 stored procedure의 의미
- stored procedure의 장단점
- 일반적인 벡엔드에서 stored procedure를 쓰기 조심스러운 이유

  

### 3-tier-architecture에서 stored procedure의 의미

  

![[image 252.png]]

  

stored procedure는 RDBMS에서 사용되는 것으로 주된 사용목적은 비즈니스 로직의 구현이다.

즉 Logic tier가 아닌 Data tier에서도 비즈니스 로직을 구현할 수 있다는 뜻

  

  

### Stored Procedure의 장점

  

1. application에 transparent하다.

![[image 253.png]]

예를 들어 DB와 접속하여 실행되는 4개의 서버가 있다고 가정

여기서 어플리케이션의 비즈니스 로직을 수정해야해서 코드 수정 후 재배포를 해야하는데

문제는 현재 트래픽을 받고 있는 상태이기 때문에 한번에 4개를 수정하는게 아니라

한 개씩 나누어서 수정하는 작업이 필요하다.

  

![[image 254.png]]

하지 비즈니스 로직이 프로시저로 관리된다면 위 처럼 할 필요없이 프로시저만 수정해주면 된다.

  

1. 네트워크 트래픽을 줄여서 응답 속도를 향상시킬 수 있다.

![[image 255.png]]

비즈니스 로직이 어플리케이션에 있다면 DB에 여러 번 왔다갔다하면서 트래픽이 생김

  

![[image 256.png]]

프로시저로 일괄 관리하면 트래픽이 줄어들어서 응답속도가 향상됨

  

1. 여러 서비스에서 재사용 가능하다.

![[image 257.png]]

A, B, C 서비스가 같은 로직을 각각 다른 언어로 구현이 되어있다고 가정한다면 세번의 로직구현이 필요해서 비효율적이다.

  

![[image 258.png]]

하지만 프로시저로 로직을 구현했다면 각 서비스에서 프로시저를 호출하기만 하면된다.

  

1. 민감한 정보에 대한 접근을 제한할 수 있다.

![[image 259.png]]

주민등록번호, 카드번호 등 개인정보를 저장해놓은 DB에 임직원 또는 개발자가 접근하지 못하게

제한을 둔 상태에서도 프로시저를 통해 DB에 접근하지 않더라도 비즈니스 로직을 구현할 수 있음

  

### **Stored Procedure의 단점**

  

1. stored procedure를 쓰게 되면 유지 관리 보수 비용이 커진다.

![[image 260.png]]

어플리케이션에도 비즈니스 로직이 있고 프로시저에도 비즈니스 로직이 있다면

어플리케이션에서만 관리하던 비즈니스 로직 코드들이 프로시저로 양분되어서 코드 분석도 힘들고

관리도 어려워진다.

또한 현재 java의 버전 관리는 굉장히 쉽지만 프로시저는 어렵다.

  

1. DB서버를 추가하는것은 간단한 작업이 아니다.

![[image 261.png]]

비즈니스 로직이 DB에 있다면 트래픽이 몰렸을 때 DB서버의 CPU에 과부하가 올 가능성이 있다.

그렇다면 새로운 DB서버를 만들어서 트래픽 부하를 좀 나눠줘야하는데

새로운 DB서버를 만들더라도 데이터를 복제해오지 못해서 사실상 쓸 수가 없다.

  

![[image 262.png]]

반면 어플리케이션 서버는 추가하는것이 간단해서 비즈니스 로직이 어플리케이션에 있다면

트래픽이 몰렸을 때 어플리케이션 서버를 추가해서 부하를 분산시키는것이 상대적으로 쉽다.

  

3. stored procedure가 언제나 transparent한 것은 아니다.

![[image 263.png]]

가. 기존에 logic() 프로시저의 이름을 ace_logic()으로 바꾸는 작업을 한다면

나. 먼저 바꾸려는 이름의 프로시저를 새로 생성한 후

다. logic tier에서 호출하는 프로시저의 이름을 새로 생성한 프로시저로 변경

라. 어플리케이션 서버 재시작

마. 기존의 logic() 프로시저 삭제

  

이렇게 오히려 logic tier의 코드 수정보다 손이 더 많이간다.

  

1. transparent 하다고 무조건 좋은건 아니다.

![[image 264.png]]

모든 어플리케이션 서버가 프로시저를 통해 비즈니스 로직을 구현중인데

여기서 비즈니스 로작에 변경이 있어서 프로시저를 수정했는데 버그가 있다면 4대 서버의 모든 트래픽이 버그로 인해 오류를 겪게된다.

  

![[image 265.png]]

하지만 logic tier에서 비즈니스 로직을 관리하면

위와 같은 상황에서 변경된 코드를 한번에 배포하지는 않고 한개씩 차례로 변경내용을 배포하는데

우선 첫 번째 서버에서 변경된 로직을 테스트 해보고 이상이 없으면 모두 변경을 한다.

테스트 간 문제가 있었다면 오류를 겪는 트래픽은 1/4로 줄어들어서 피해를 최소화할 수 있다.

  

1. 비즈니스 로직을 소스 코드(logic tier)에 두고도 응닶 속도를 향상 시킬 수 있다.

![[image 266.png]]

쿼리가 동시에 진행이 가능하다면 logic tier에서도 응답속도를 향상 시킬 수 있음

  

![[image 267.png]]

또한 캐싱 기법을 통해서 응답속도를 향상시킬 수 있는데

자주 사용되는 쿼리의 결과를 캐시에 저장해두고

  

![[image 268.png]]

다음에 같은 쿼리를 조회시 캐시에 저장된 값을 바로 가져다 줌

  

![[image 269.png]]



**출처 : 유튜브 쉬운코드 https://www.youtube.com/@ezcd