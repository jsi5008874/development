  

![[image 230.png]]

  

**MySQL은 크게 MySQL 엔진(서버 엔진)과 스토리지 엔진으로 구성**

  

### MySQL 엔진(서버 엔진)

요청된 SQL 문장을 분석하거나 쿼리 최적화 등 DBMS의 두뇌 역할

  

1. Connection Handler : 커넥션 및 쿼리 요청 처리 담당
2. SQL Interface : DML, DDL, Procedure, View 등 SQL 인터페이스 담당
3. SQL 파서 : SQL 문법 오류 탐지 및 SQL 쿼리 문장을 토큰으로 분리하고 트리 형태로 파싱
4. 전처리기(Preprocessor) : 파서에서 만들어진 트리를 토대로 SQL 문에 구조적인 문제 확인

테이블명, 컬럼명, 내장 함수, 접근 권한 등

1. SQL 옵티마이저 : 쿼리 최적화 실행 및 쿼리 실행 계획 결정
2. 엔진 / 쿼리 실행기(Engine excutor) : 실행 계획을 수행하고 최적화 된 방식으로 스토리지

엔진에게 데이터 저장 및 조회 요청 및 응답 반환

  

핸들러 API : MySQL 엔진의 쿼리 실행기에서 데이터를 읽거나 쓸 때 스토리지 엔진에 요청을 보낸다

이러한 요청을 핸들러 요청이라 하고, 사용되는 API를 핸들러 API라 한다.

  

### 스토리지 엔진

**실제 데이터를 디스크에 저장하거나 읽어오는 처리를 담당**

스토리지 엔진은 여러 개를 동시에 사용 가능

  

MySQL의 스토리지 엔진에는 두 종류가 있다.

  

**MyISAM**

MySQL 5.5버전 이전까지 사용된 스토리지 엔진으로 현재는 거의 사용하지 않는다.

  

MyISAM 특징

1. Table-Level Locking을 지원하며 읽기 성능은 우수하지만 쓰기 성능이 떨어진다.
2. 트랜잭션을 지원하지 않는다.
3. 데이터 충돌 시 복구 불가능
4. 대용량 데이터 읽기에 적합
5. FULLTEXT 검색 지원

>> Like 검색보다 훨씬 효율적인 검색으로 단어 단위 검색, 연관도 기반 정렬 가능

인덱스를 기반으로 검색하고 자연어 처리로 속도가 훨씬 빠르다.

ex)

CREATE TABLE articles (  
id INT AUTO_INCREMENT PRIMARY KEY,  
title VARCHAR(255),  
content TEXT,  
FULLTEXT(title, content) —→ FULLTEXT 인덱스 생성  

);

  

SELECT * FROM articles  
WHERE MATCH(title, content) AGAINST('MySQL 검색' IN NATURAL LANGUAGE MODE);  

  

1. 외래키 미지원

  

검색엔진, 로그 데이터 저장 등 대용량 데이터 조작에 주로 사용됨

하지만 InnoDB에서도 FULLTEXT 검색이 지원되므로 InnoDB를 많이 사용

  

**InnoDB**

MySQL 5.5 버전 이상부터 사용

  

InnoDB 특징

1. 트랜잭션 지원(ACID 준수)
2. Row-Level-Locking 지원(쓰기 성능 우수)
3. 데이터 무결성 보장(외래 키 지원)
4. 충돌 발생 시 롤백 가능

  

금융 서비스, 쇼핑몰 등 트랜잭션 및 데이터 무결성 필요한 곳에 주로 사용

  

  

### MySQL 스레딩 구조

  

**포그라운드 스레드(클라이언트 스레드)**

1. MySQL 서버에 접속된 클라이언트의 수만큼 존재, 사용자가 요청하는 쿼리를 처리
2. 사용자가 작업을 마치고 커넥션을 종료하면 해당 스레드는 스레드 캐시로 돌아감
3. 스레드 캐시에 일정 수 이상 있으면 해당 스레드는 종료
4. InnoDB 기준 데이터 버퍼나 캐시까지만 포그라운드 스레드가 처리, 버퍼로부터 디스크까지 기록하는 작업은 백그라운드 스레드가 처리

  

**백그라운드 스레드**

InnoDB에서 백그라운드로 처리되는 작업

- 인서트 버퍼를 병합하는 스레드
- 로그를 디스크로 기록하는 스레드
- InnoDB 버퍼 풀의 데이터를 디스크에 기록하는 스레드
- 데이터를 버퍼로 읽어 오는 스레드
- 잠금이나 데드락을 모니터링하는 스레드

  

  

### 메모리 할당 및 사용 구조

MySQL 메모리 구조는 글로벌 메모리 영역과 로컬(세션) 메모리 영역으로 나뉜다.

  

**글로벌 메모리**

모든 스레드가 공유하는 영역

  

**로컬(세션) 메모리**

클라이언트 스레드가 쿼리를 처리하는데 쓰이는 영역

스레드 별 독립적인 영역